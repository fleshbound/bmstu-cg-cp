\chapter{Аналитическая часть}

\section{Формализация модели}

Сцена состоит из:

\begin{itemize}
    \item источника света,
    \item трехмерного объекта,
    \item наблюдателя,
    \item зеркала,
    \item ограничивающей плоскости.
\end{itemize}

\emph{Источник света} является материальной точкой, из которой во все стороны исходят лучи света.
Он не может отражать или преломлять свет.
В частном случае, когда источник расположен в бесконечности, он имеет направленность.
Положение источника света задается трехмерными координатами, цвет света описывается через RGB-параметры.
Количество источников света не может меняться.

\emph{Трехмерный объект} отображается с помощью модели из стандартного набора: пирамида, призма, шар.
Основные параметры выбранной модели (например, количество углов основания у призмы) могут меняться.

Положение \emph{наблюдателя} и \emph{трехмерного объекта} задается координатами x, y, z. 
Они могут меняться посредством поворота, переноса.

\emph{Зеркало} представляет собой трехмерный объект, свойства поверхности которого могут задаваться пользователем (степень полировки, цвет, радиус кривизны, размеры зеркала).
Цвет поверхности описывается через RGB-параметры.
Степень полировки и радиус кривизны задаются численно.
Размеры зеркала представляются длиной и шириной, задаются численно. 
Глубина зеркала будет определяться программистом и не может меняться пользователем.

\emph{Ограничивающая плоскость} представляет собой бесконечную плоскость, которая ограничивает нерабочую область зеркала и содержит его рабочую плоскость.
Предполагается, что трехмерный объект и наблюдатель находятся со стороны рабочей поверхности зеркала.

\section{Выбор модели представления объекта}

Модели бывают: каркасные, поверхностные, объемные. \cite{lisyak}

Недостатком использования каркасной модели является неоднозначность получаемого результата, а объемной -- избыточность для нашей задачи информации о материале поверхности объекта.

Таким образом, будет использоваться \emph{поверхностная} модель представления объекта, в которой его поверхность будет описываться, например, аналитически.
Это позволит получать однозначный результат с необходимым минимумом информации об объекте.

\section{Выбор модели освещения}

Предназначением модели освещения является расчет интенсивности отраженного от объектов света.
Существует два вида таких моделей: локальная и глобальная. \cite{zadorozhniy, globalillum}

\subsection{Локальная модель освещения}

Особенностью локальной модели освещения является то, что в них не учитывается влияние предметов друг на друга.
Другими словами, в них на закраску объекта влияют лишь источники света.

\subsection{Глобальная модель освещения}

Глобальная же модель освещения учитывает также отражение света от других объектов или его прохождение сквозь них.
Таким образом, возможно добиться изображения отражений.

\subsection{Вывод}

Исходя из того, что перед нами стоит цель моделирования поверхности зеркала, выбор падает на \emph{глобальную модель освещения}.
Таким образом, отпадает необходимость рассматривать конкретные примеры локальных моделей освещения.

\section{Выбор алгоритма удаления невидимых ребер и поверхностей}

В зависимости от системы координат алгоритмы делятся на:
\begin{itemize}
    \item работающие в пространстве экрана (изображения),
    \item работающие в пространстве сцены (объектов). \cite{golovnin}
\end{itemize}

Основной идеей алгоритмов, работающих в пространстве экрана, является нахождение видимых точек для каждого объекта и их отображение на экране в виде пикселей.
В ходе их работы пиксель рисуется один раз, а отношения между объектами анализируются более одного раза.
Объем вычислений для таких алгоритмов растет, как $C*N$, где $C$ - количество пикселей, $N$ - количество граней объекта.

Идеей же алгоритмов, работающих в пространстве сцены, является оперирование геометрическими примитивами, проверка их пересечений и получение списка видимых объектов и их частей. 
В ходе их работы пиксель может перерисовываться более одного раза, а объект анализируется один раз.
Объем вычислений для таких алгоритмов растет, как $N^2$, где $N$ - количество граней объекта.

В рамках данной практической работы основными критериями выбора алгоритма удаления невидимых ребер и поверхностей является:
\begin{itemize}
    \item точность результата работы алгоритма,
    \item возможность использования глобальной модели освещения.
\end{itemize}

Сведем описание алгоритмов к общему виду:
\begin{itemize}
    \item пространство, в котором работает алгоритм (сцены, экранное);
    \item обрабатываемые объекты;
    \item суть алгоритма;
    \item возможность использования глобальной модели освещения;
    \item точность результатов.
\end{itemize}

\subsection{Алгоритм обратной трассировки лучей}

Характеристики алгоритма:
\begin{itemize}
    \item пространство алгоритма -- экранное;
    \item обрабатываются объекты, представленные поверхностными или объемными моделями;
    \item суть алгоритма заключается в отслеживании взаимодействия лучей, испускаемых из точки наблюдения, с описывающими объекты сцены сферами и/или параллелепипедами, что существенно сокращает количество вычислений по сравнению с прямой трассировкой, однако алгоритм все еще является ресурсозатратным \cite{yanova, porev};
    \item имеется возможность использования глобальной модели освещения;
    \item высокая точность результатов, так как работа идет непосредственно с точками, принадлежащими объектам.
\end{itemize}

\subsection{Алгоритм испускания лучей (raycasting)}

Характеристики алгоритма:
\begin{itemize}
    \item пространство алгоритма -- экранное;
    \item обрабатываются объекты простой формы, представленные поверхностными моделями;
    \item суть алгоритма заключается в том, что для каждого луча, испускаемого из точки наблюдения, рассчитывается и запоминается расстояние, которое он прошел до столкновения с ближайшим объектом сцены, и в дальнейшем объекты визуализируются в зависимости от этого расстояния;
    \item отсутствует возможность использования глобальной модели освещения;
    \item высокая точность результатов, так как работа идет непосредственно с точками, принадлежащими объектам. \cite{evstratov, raycasting, habrraycasting}
\end{itemize}

\subsection{Алгоритм развития лучей (raymarching)}

Характеристики алгоритма:
\begin{itemize}
    \item пространство алгоритма -- экранное;
    \item обрабатываются объекты, представленные поверхностными и объемными моделями;
    \item суть алгоритма заключается в том, что для каждого луча, испускаемого из точки наблюдения, происходит его развитие вдоль заданного направления и нахождение пересечения с объектом, при этом для каждой точки развития луча определяется радиус, на который можно пустить луч, на основе которого и значения вспомогательной функции поля расстояний со знаком (SDF) делается вывод о пересечении;
    \item имеется возможность использования глобальной модели освещения;
    \item низкая точность результатов, так как работа идет не с точками объекта, а с вычисляемыми точками пересечения. \cite{raymarching}
\end{itemize}

\subsection{Вывод}

Для наглядности составим таблицу, содержащую информацию о каждом рассмотренном алгоритме (таблица \ref{table:methods})

%\afterpage{
%\begin{table}[ht]
%    \caption{Анализ алгоритмов удаления невидимых ребер и поверхностей}
\noindent{
    \captionof{table}{Анализ алгоритмов удаления невидимых ребер и поверхностей}
    \renewcommand{\arraystretch}{1}
    \small
    \begin{xltabular}{\linewidth}{|M{4cm}|*{3}{Y|}}
        \hline
        \footnotesize                                                 & Обратная трассировка лучей & Испускание лучей & Развитие лучей \\
        \hline
        Пространство, в котором работает алгоритм                     & Экранное & Экранное & Экранное \\
        \hline
        Сложность алгоритма                                           & $O(C*N)$ & $O(C*N)$ & $O(C*N)$ \\
        \hline
        Наличие возможности использования глобальной модели освещения & +        & --       & +        \\
        \hline
        Высокая точность результатов                                  & +        & +        & --       \\
        \hline
    \end{xltabular}
    \label{table:methods}
}
%\end{table}
%}

\indent Исходя из формализации модели, описания алгоритмов и составленной таблицы был сделан выбор в сторону \emph{алгоритма обратной трассировки лучей}.

\section{Выбор метода закраски}

Рассмотрим несколько методов закраски поверхностей: метод Гуро, метод Фонга, метод обратной трассировки лучей. \cite{colormethods}

\subsection{Метод Гуро}

\emph{Метод Гуро} основывается на билинейной интерполяции интенсивностей для создания иллюзии гладкой криволинейной поверхности.

\subsection{Метод Фонга}

\emph{Метод Фонга} заключается в билинейной интерполяции векторов нормалей граней. Это является еще более трудоемким процессом.

Стоит отметить, что оба эти метода применяются только к поверхностым моделям представления объектов.

\subsection{Метод обратной трассировки лучей}

\emph{Метод обратной трассировки лучей} по сути уже был описан в предыдущем пункте.
Для закраски объектов используется рекурсия -- добавляются отраженные и преломленные лучи и так далее, пока не будет достигнут предел рекурсии.

\subsection{Вывод}

Наиболее удобным и точным методом закраски для достижения поставленной цели будет являться \emph{метод обратной трассировки лучей}.

\section{Вывод}

В ходе проведения анализа были выбраны: поверхностные модели представления объектов, глобальная модель освещения, метод обратной трассировки лучей (как для удаления невидимых ребер и поверхностей, так и для закраски).