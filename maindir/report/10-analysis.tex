\chapter{Аналитическая часть}

Модель, используемая в работе, требует соблюдения физических законов.

\section{Формализация задачи}

На рисунке \ref{img:task_diagram_a0} представлена диаграмма IDEF0 формализуемой задачи.

\includeimage{task_diagram_a0}{f}{h}{0.9\textwidth}{Диаграмма IDEF0} 

Модель --- отображение формы и размеров какой-либо сущности~\cite{куров}.
В данной работе используется поверхностное представление моделей, при котором они представляются аналитически (полностью или частично)~\cite{куров}.
Процесс получения модели называется моделированием.

%Положение точки в (трехмерном) пространстве задается координатами, направление --- вектором.

Сцена состоит из набора сущностей:
\begin{enumerate}
	\item \textit{наблюдатель (камера)}, характеризующийся положением точки наблюдения в пространстве, направлениями взгляда и оси, направленной вверх~\cite{куров};
	\item \textit{точечный источник света}, характеризующийся положением в пространстве, интенсивностью и цветом света~\cite{куров};
	\item \textit{объект} --- модель геометрического тела, геометрические свойства (радиус, высота и так далее) которой определяются заданными пользователем параметрами;
	\item \textit{зеркало} --- модель ограниченной поверхности, обладающая степенью полировки, цветом, радиусом и описанием границ.
\end{enumerate}

\section{Физическая природа зеркальных поверхностей}

Луч (световой) --- узкий пучок света, представленный геометрической линией, вдоль которой распространяется свет \cite{тюрин2005физика}, \cite{оптика20036}. 

Если луч падает на поверхность в точку $A$ и отражается от нее, а через эту точку к поверхности проведена нормаль $n$, то углы, заключенные между нормалью и направлениями падающего, отраженного лучей ($a$, $b$), называются углами \textit{падения}, \textit{отражения} соответственно \cite{тюрин2005физика}, \cite{оптика20036}, \cite{rodionov}.
Описанные элементы представлены на рисунке \ref{img:reflection}.

\includeimage{reflection}{f}{h}{0.9\textwidth}{Отражение луча от поверхности}

Зеркало --- поверхность, от которой отражаются лучи.

Зеркальное отражение --- такое, для которого справедлива формула \ref{eq:reflect}:
\begin{equation}\label{eq:reflect}
	\alpha=\beta,
\end{equation}
где $\alpha$ --- угол падения, $\beta$ --- угол отражения, лучи и нормаль находятся в одной плоскости \cite{порев2002компьютерная}, \cite{оптика20036}, \cite{rodionov}.

% Написать тут про глобальную модель освещения?
Если от зеркала происходит зеркальное отражение, оно называется идеальным, иначе --- реальным \cite{порев2002компьютерная}. Связь интенсивности отраженного луча $I_b$ с интенсивностью падающего под углом $\alpha$ луча $I_a$ представлена в формулах \ref{eq:ideal_intense} и \ref{eq:intense_phong} для случаев идеального и реального зеркала соответственно \cite{порев2002компьютерная}, \cite{оптика20036}:

\begin{equation}\label{eq:ideal_intense}
	I_b=I_a
\end{equation}

\begin{equation}\label{eq:intense_phong}
	I_b=I_a K_b cos^p{\alpha},
\end{equation}
где $K_b$ --- некоторый числовой коэффициент пропорциональности, $p$ --- число от 1 до 200 \cite{порев2002компьютерная}.

\section{Существующие алгоритмы решения задачи синтеза изображения}

Среди известных алгоритмов визуализации поверхностей существуют такие алгоритмы, как отслеживание лучей (raycasting), пошаговое распространение лучей (ray marching), прямая и обратная трассировки лучей.

\subsection{Описание алгоритмов}

В соответствии с \cite{евстратов2020создание} \textit{алгоритм отслеживания лучей (raycasting)} позволяет обрабатывать поверхностные модели и представляется в виде последовательности шагов (выполняемыми для каждого пикселя экрана):
\begin{enumerate}
	\item провести луч из точки наблюдения;
	\item рассчитать расстояние от места испускания луча до каждого из объектов сцены;
	\item определить, для какого из них оно является наименьшим;
	\item выполнить визуализацию вертикальной <<полосы>> этого объекта.
\end{enumerate}

\textit{Алгоритм пошагового распространения лучей (ray marching)} описывается в \cite{bredenbals2022visualising} для каждого луча, испускаемого из точки наблюдения через пиксели экрана, следующими действиями:
\begin{enumerate}
	\item рассчитать значения функции расстояния со знаком до каждого объекта сцены относительно текущей точки начала распространения луча;
	\item выбрать наименьшее из этих значений;
	\item если выбранное расстояние меньше некоторой заданной малой величины, запустить рекурсивное распространение лучей из точки объекта в соответствии с оптическими свойствами его поверхности;
	\item если выбранное расстояние больше некоторой заданной большой величины, визуализировать фон;
	\item принять за следующую точку начала ту, которая находится на выбранном расстоянии по направлению распространения исходного луча, перейти на шаг 1.
\end{enumerate}

\textit{Прямая трассировка лучей} заключается 

\textit{Обратная трассировка лучей} представлена авторами \cite{порев2002компьютерная}, \cite{демин2011} с помощью этапов:
\begin{enumerate}
	\item от наблюдателя в каждую точку (пиксель) экрана проводится луч;
	\item луч достигает объекта, преломляясь или отражаясь, то есть порождает вторичные лучи;
	\item обработка луча (аналогичная обработке луча в прямой трассировке лучей) прекращается, когда он перестает пересекать объекты сцены.
\end{enumerate}

\subsection{Сравнение алгоритмов}

На основе источников, которые были использованы для приведенного выше описания, осуществлено сравнение анализируемых алгоритмов.

В таблице \ref{tab:compare} приведены результаты сравнения, критерии которого расположены по горизонтали и включают в себя:
\begin{enumerate}
	\item сложность алгоритма в зависимости от чисел пикселей $C$ и объектов $N$;
	\item рабочее пространство алгоритма (сцены --- <<С>>, экранное --- <<Э>>);
	\item форма моделей, которая может быть использована при использовании алгоритма (каркасная~---~<<К>>, поверхностная --- <<П>>, объемная --- <<О>>);
	\item возможность использования глобальной модели освещения;
	\item принадлежность обрабатываемых точек объекту.
\end{enumerate}

\begin{table}[hbtp]
	\begin{center}
		\begin{flushleft}
			\caption{\label{tab:compare}Сравнение существующих алгоритмов решения задачи синтеза изображения в контексте моделирования статической сцены}
		\end{flushleft}
		\begin{tabular}{|l | l | l | l | l | l |} 
			\hline 
			~					& {1} & {2} & {3} & {4} & {5} \\ \hline
			Отслеживание лучей & \texttt{$O(C \cdot N)$} & Э & П  & Нет & Да \\ \hline
			Пошаговое распространение лучей & \texttt{$O(C \cdot N)$} & Э & О & Да & Нет \\ \hline
			Прямая трассировка лучей & \texttt{$O(C \cdot N)$} & Э & О & Да & Да \\ \hline
			Обратная трассировка лучей & \texttt{$O(C \cdot N)$} & Э & О & Да & Да \\ \hline
		\end{tabular}
	\end{center}
\end{table}

\section*{Вывод}

